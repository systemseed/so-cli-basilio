name: sync:download:db
description: Pulls database backup without PII (personal identifiable information) from AWS.
command: | 
  cd $so_project_root
  so mi "Downloading latest database backup from ${S3_DB_BACKUPS_FOLDER} to ${BACKUP_DIR}/${BACKUP_DB_FILE_NAME}..."
  BACKUP_FILENAME=$(docker compose run --rm hosting aws s3 ls "${S3_DB_BACKUPS_FOLDER}" | sort | tail -n 10 | awk '{print $4}' | grep -w ".*-without-pii.gzip" | tail -n 1)
  docker compose run --rm hosting aws s3 cp ${S3_DB_BACKUPS_FOLDER}${BACKUP_FILENAME} /backup/db/${BACKUP_DB_FILE_NAME}
  so mi "Done."
